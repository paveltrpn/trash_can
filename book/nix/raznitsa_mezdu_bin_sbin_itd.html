<!DOCTYPE HTML>
<html>
    <head>
        <title>Разница между bin, sbin, usr/bin, usr/sbin</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../css/style.css">
    </head>
    <body>
        <div class="A4">
            <br>
            <p class="section">
                Разница между bin, sbin, usr/bin, usr/sbin
            </p>

            <p class="small">
                (https://habr.com/ru/post/143614/)
            </p>

            <p class="plane">
                30 ноября 2010 года Дэвид Коллиер <i>(David Collier)</i> писал:
            </p>
            
            <p class="plane">
                <blockquote>
                    Я заметил, что в busybox ссылки разложены по этим четырём директориям. Есть ли какое-то простое правило, 
                    чтобы определить, в какой директории какая из ссылок должна лежать… К примеру, kill лежит 
                    в /bin, а killall — в /usr/bin… Я не вижу никакой логики в таком разделении. 
                </blockquote>
            </p>

            <p class="plane">
                Вы, наверное, знаете, что Кен Томпсон и Дэннис Ритчи создали <i>Unix</i> на <i>PDP-7</i> в 1969-ом. Так вот, 
                примерно в 1971 они проапгрейдились до <i>PDP-11</i> с парой дисков <i>RK05</i> (по 1,5 мегабайта каждый).
            </p>

            <p class="plane">
                Когда операционная система разрослась и перестала помещаться на первом диске 
                (на котором была расположена корневая ФС), они перенесли часть на второй, где располагались домашние 
                директории (поэтому точка монтирования называлась /usr — от слова user). Они продублировали 
                там все необходимые директории ОС <i>(/bin, /sbin, /lib, /tmp ...)</i> и складывали файлы на новый 
                диск, потому что на старом кончилось место. Потом у них появился третий диск, они примонтировали 
                его в директории /home и перенесли туда домашние директории пользователей, чтобы ОС могла занять 
                всё оставшееся место на двух дисках, а это были целых три мегабайта (огого!). 
            </p>

            <p class="plane">
                Разумеется, им пришлось ввести правило, что «когда операционная система загружается, 
                она должна быть в состоянии примонтировать второй диск в директорию <i>/usr</i>, поэтому не 
                надо класть программы типа mount на второй диск в <i>/usr</i>, а то получим проблему курицы и яйца». 
                Вот так просто. И это относилось к <i>Unix V6</i> 35 лет назад.
            </p>

            <p class="plane">
                Разделение /bin и /usr/bin (и всех подобных директорий) — это последствие тех событий, деталь реализации 
                из 70-х, которая до сих пор, в течение десятилетий, копировалась бюрократами. Они никогда не задавали 
                вопрос почему, они просто делали так. Это разделение перестало иметь смысл ещё до того, как Linux был 
                создан, по нескольким причинам:
            </p>

            <p class="plane">
                &emsp; 1. При загрузке используется initrd или initramfs, который берёт на себя проблемы типа «этот файл нам нужен раньше чем тот». Таким образом, у 
                нас уже есть временная файловая система, которая используется для загрузки всего остального.
            </p>

            <p class="plane">
                &emsp; 2. Разделяемые библиотеки (которые были добавлены в Unix ребятами из Berkley) не позволяют вам независимо 
                менять содержимое /lib и /usr/lib. Эти две части должны соответствовать друг другу, иначе они не будут работать. 
                Этого не происходило в 1974-ом, поскольку тогда у них была некоторая независимость из-за статической линковки.
            </p>

            <p class="plane">
                &emsp; 3. Дешёвые жёсткие диски преодолели барьер в 100 мегабайт где-то в 1990-ом и примерно в то же время появились 
                программы для изменения размера разделов (partition magic 3.0 вышла в 1997-ом).
            </p>

            <p class="plane">
                Разумеется, поскольку разделение есть, некоторые люди придумали правила, которые его оправдывают. 
                Типа, корневой раздел нужен для всяких общих штучек ОС, а в /usr надо класть свои локальные файлы. 
                Или в / помещают то, что распространяет AT&T, а в /usr — то, что твой дистрибутив, IBM AIX, или Dec 
                Ultrix, или SGI Irix добавили, а в /usr/local лежат файлы, специфичные для твоей системы. 
                А потом кто-то решил, что /usr/local — это не подходящее место, чтобы туда устанавливать новый софт, 
                так что давайте ещё добавим /opt! Не удивлюсь, если появится ещё и /opt/local… 
            </p>

            <p class="plane">
                Разумеется, за 30 лет из-за такого разделения появлялись и исчезали всякие интересные специфичные 
                для отдельных дистрибутивов правила. Например, «/tmp очищается при перезагрузке, а /usr/tmp — нет». 
                (И в Ubuntu /usr/tmp нет в принципе, а в Gentoo /usr/tmp — это символическая ссылка на /var/tmp, на 
                который теперь распространяется то правило, и он не очищается при перезагрузке. Да, это всё было ещё 
                до tmpfs. А ещё бывает, что корневая ФС доступна только на чтение, и тогда в /usr тоже не надо ничего 
                писать, а надо писать в /var. Или в / в основном нельзя писать, не считая того, что в /etc, которую 
                иногда пытались перенести в /var...)
            </p>

            <p class="plane">
                Бюрократы вроде Linux Foundation (которые поглотили Free Standards Group во время расширения годы назад) 
                с радостью документируют и усложняют эти правила, даже не пытаясь понять, почему они появились.
                Они не догадываются, что Кен и Дэннис просто перенесли часть ОС в их домашнюю директорию, 
                из-за того, что диск RK05 на PDP-11 был слишком мал.
            </p>

            <p class="plane">
                Я практически уверен, что в busybox просто помещает файлы так же, как это исторически сложилось. 
                Нет никакой реальной причины делать так до сих пор. Лично я просто делаю /bin, /sbin и /lib ссылками 
                на аналогичные директории в /usr. Ведь люди, которые работают со встраиваемым софтом, стараются разбираться и упрощать…
            </p>

            <br>
        </div>
    </body>
</html>